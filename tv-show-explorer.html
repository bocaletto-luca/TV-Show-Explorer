<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>TV Show Explorer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Bootstrap 5 CSS (Free & Open Source) -->
  <!-- (Italian: CSS di Bootstrap 5, gratis e open source) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <style>
    /* Global Styles / Stili Globali */
    body {
      background-color: #f8f9fa;
      color: #212529;
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
    }
    .container {
      padding: 20px;
    }
    header {
      text-align: center;
      margin-bottom: 20px;
    }
    /* Search Form */
    #searchForm .input-group {
      max-width: 600px;
      margin: 0 auto 20px auto;
    }
    /* Grid layout for show results */
    #results {
      margin-top: 20px;
    }
    .card-img-top {
      object-fit: cover;
      height: 250px;
    }
    .cursor-pointer {
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header / Intestazione -->
    <header>
      <h1>TV Show Explorer</h1>
      <p>Search for TV shows, view cast details, and explore episodes using the TV Maze API.</p>
      <!-- (Italian: Cerca spettacoli TV, visualizza i dettagli del cast ed esplora gli episodi usando l'API TV Maze.) -->
    </header>
    
    <!-- Search Form / Modulo di Ricerca -->
    <form id="searchForm" class="mb-3">
      <div class="input-group">
        <input type="text" id="searchQuery" class="form-control" placeholder="Enter TV Show name" required>
        <button class="btn btn-primary" type="submit">Search</button>
      </div>
    </form>
    
    <!-- Results Container / Contenitore dei Risultati -->
    <div id="results" class="row row-cols-1 row-cols-md-3 g-4"></div>
  </div>
  
  <!-- Fullscreen Modal for Show Details / Modal a schermo intero per i Dettagli dello Spettacolo -->
  <div class="modal fade" id="detailsModal" tabindex="-1" aria-labelledby="detailsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-fullscreen modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="detailsModalLabel">Show Details</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body" id="modalBody">
          <!-- Show details (summary, cast, episodes) will be dynamically inserted here -->
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Bootstrap Bundle JS (includes Popper.js) / Script di Bootstrap (incluso Popper.js) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  
  <!-- Main JavaScript / Script Principale -->
  <script>
    // ===============================
    // Global Variables & DOM Elements
    // (Italiano: Variabili Globali ed Elementi del DOM)
    // ===============================
    const searchForm = document.getElementById('searchForm');
    const searchQuery = document.getElementById('searchQuery');
    const resultsDiv = document.getElementById('results');
    const detailsModal = new bootstrap.Modal(document.getElementById('detailsModal'));
    const modalBody = document.getElementById('modalBody');
    
    // ===============================
    // Event Listener for Search Form Submission
    // (Italiano: Gestione del submit del modulo di ricerca)
    // ===============================
    searchForm.addEventListener('submit', function(e) {
      e.preventDefault();
      const query = searchQuery.value.trim();
      if (query) {
        searchShows(query);
      }
    });
    
    // ===============================
    // Function: Search for TV Shows
    // (Italiano: Funzione per cercare spettacoli TV)
    // Uses TV Maze API to search shows by name.
    // ===============================
    async function searchShows(query) {
      resultsDiv.innerHTML = '<p>Loading shows...</p>';
      try {
        const response = await fetch(`https://api.tvmaze.com/search/shows?q=${encodeURIComponent(query)}`);
        if (!response.ok) throw new Error('Network response not ok');
        const data = await response.json();
        displayShows(data);
      } catch (error) {
        console.error(error);
        resultsDiv.innerHTML = '<p class="text-danger">Error retrieving shows. Please try again later.</p>';
      }
    }
    
    // ===============================
    // Function: Display TV Show Cards
    // (Italiano: Funzione per visualizzare le schede degli spettacoli TV)
    // Iterates over search results and creates a card for each show.
    // ===============================
    function displayShows(shows) {
      resultsDiv.innerHTML = '';
      if (shows.length === 0) {
        resultsDiv.innerHTML = '<p>No shows found!</p>';
        return;
      }
      shows.forEach(item => {
        const show = item.show;
        const col = document.createElement('div');
        col.className = 'col';
        col.innerHTML = `
          <div class="card h-100 cursor-pointer" onclick="viewShowDetails(${show.id})">
            <img src="${show.image ? show.image.medium : 'https://via.placeholder.com/210x295?text=No+Image'}" class="card-img-top" alt="${show.name}">
            <div class="card-body">
              <h5 class="card-title">${show.name}</h5>
              <p class="card-text">${show.summary ? show.summary.replace(/<[^>]*>?/g, '').substring(0, 100) + '...' : 'No summary available.'}</p>
            </div>
          </div>
        `;
        resultsDiv.appendChild(col);
      });
    }
    
    // ===============================
    // Function: View TV Show Details
    // (Italiano: Funzione per visualizzare i dettagli di uno spettacolo TV)
    // Fetches show details, cast, and episode data from TV Maze.
    // ===============================
    async function viewShowDetails(showId) {
      try {
        // Fetch show details, cast, and episodes concurrently
        const [showRes, castRes, episodesRes] = await Promise.all([
          fetch(`https://api.tvmaze.com/shows/${showId}`),
          fetch(`https://api.tvmaze.com/shows/${showId}/cast`),
          fetch(`https://api.tvmaze.com/shows/${showId}/episodes`)
        ]);
        if (!showRes.ok || !castRes.ok || !episodesRes.ok) {
          throw new Error('Error retrieving show details');
        }
        const showData = await showRes.json();
        const castData = await castRes.json();
        const episodesData = await episodesRes.json();
        displayShowDetails(showData, castData, episodesData);
      } catch (error) {
        console.error(error);
        alert('Error retrieving show details. Please try again later.');
      }
    }
    
    // ===============================
    // Function: Display Show Details in Modal
    // (Italiano: Funzione per visualizzare i dettagli dello spettacolo nel modal)
    // Populates the modal with the show summary, cast list, and grouped episodes.
    // ===============================
    function displayShowDetails(show, cast, episodes) {
      let html = `<div class="container-fluid">
        <div class="row mb-3">
          <div class="col-md-4">
            <img src="${show.image ? show.image.medium : 'https://via.placeholder.com/210x295?text=No+Image'}" class="img-fluid" alt="${show.name}">
          </div>
          <div class="col-md-8">
            <h3>${show.name}</h3>
            <p>${show.summary || 'No summary available.'}</p>
            <p><strong>Rating:</strong> ${show.rating.average || 'N/A'}</p>
            <p><strong>Genres:</strong> ${show.genres.join(', ') || 'N/A'}</p>
          </div>
        </div>
        <div class="row">
          <div class="col">
            <h4>Cast</h4>`;
      if (cast.length === 0) {
        html += `<p>No cast information available.</p>`;
      } else {
        html += `<ul>`;
        cast.forEach(member => {
          html += `<li>${member.person.name} as ${member.character.name}</li>`;
        });
        html += `</ul>`;
      }
      html += `</div>
        </div>
        <div class="row mt-3">
          <div class="col">
            <h4>Episodes</h4>`;
      if (episodes.length === 0) {
        html += `<p>No episodes available.</p>`;
      } else {
        // Group episodes by season
        let episodesBySeason = {};
        episodes.forEach(ep => {
          if (!episodesBySeason[ep.season]) {
            episodesBySeason[ep.season] = [];
          }
          episodesBySeason[ep.season].push(ep);
        });
        for (const season in episodesBySeason) {
          html += `<h5>Season ${season}</h5><ul>`;
          episodesBySeason[season].forEach(ep => {
            html += `<li><strong>Episode ${ep.number}:</strong> ${ep.name} (Air date: ${ep.airdate})</li>`;
          });
          html += `</ul>`;
        }
      }
      html += `</div></div>`;
      
      modalBody.innerHTML = html;
      detailsModal.show();
    }
  </script>
</body>
</html>
